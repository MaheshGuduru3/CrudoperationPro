<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>CRUD OPERATIONS</title>
    <style>
        .main{
            width:100%;
            height: 100vh;
        }
        .input-size{
           width:40%;
        }
        .profile{
            width:10%;
            height: 10vh;
        }
        .display-info{
            width: 30%;
            height: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            border: 2px solid black;
            border-radius: 5px;
        }
        .icons{
            display: flex;
            gap: 1rem;
            cursor: pointer;
        }

        #successed{
            display: none;
            justify-content: center;
            align-items: center;
        }
        #want_input{
            display: none;
            justify-content: center;
            align-items: center;
        }
        #want1_input{
            display: none;
            justify-content: center;
            align-items: center;
        }
        #error{
            display: none;
            justify-content: center;
            align-items: center;
        }
        #deleted{
            width:20%;
            display: none;
            flex-direction: row;
            justify-content: space-evenly;
            position:absolute;
            top:0;
            right: 0;
        }
        .search-con{
            width:20%;
            height:5vh;
        }
       @media (max-width:550px) {
           .input-size{
            width:100%;
           }
           .search-con{
            width:100%;
            height:5vh;
        }
           .display-info{
            width: 100%;
            height: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            border: 2px solid black;
            border-radius: 5px;
        }
        #deleted{
            width:100%;
            position: relative;
            top:10%;
        }
       }

       @media (min-width:700px) {
        .display-info{
            width: 50%;
            height: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            border: 2px solid black;
            border-radius: 5px;
        }
        .search-con{
            width:40%;
            height:5vh;
        }
       }

       @media (min-width:1000px) {
        .display-info{
            width: 30%;
            height: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            border: 2px solid black;
            border-radius: 5px;
        }
        .search-con{
            width:20%;
            height:5vh;
        }
       }
       @media (max-width:300px){
        .display-info{
            width: 60%;
            height: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid black;
            border-radius: 5px;
            padding:1rem
        }
       }

       @media (width>=550px) and (width <= 770px){
        .display-info{
            width: 60%;
            height: auto;
            display: flex;
            flex-direction: row;
            align-items: center;
            border: 2px solid black;
            border-radius: 5px;
            padding:1rem
        }
       }

    </style>
</head>
<body>
    <!--HERE IS THE MAIN PAGE START WITH THESE-->
    <div class="container-fluid border b-2 main">
        <div class="container d-flex border b-2 flex-column align-items-center bg-primary p-2">
            <!--HERE IS THE TITLE NAME -->
            <div class="h2 mt-1">CRUD CONTACT LIST</div>
            <input class="form-control input-size mt-2" id='input_name' type="text" placeholder="Enter the name" required>
            <input class="form-control input-size mt-2" id='input_email' type="email" placeholder="Enter the email" required>
            <button type="button" class="btn btn-outline-danger mt-3" onclick="btn_info()">ADD CONTACT</button>
            <!--HERE THE ALERT BOX SAYING THAT INPUT IS REQUIRED HERE   -->
            <div class="alert alert-danger  mt-2" role="alert" id="want_input">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bug-fill" viewBox="0 0 16 16">
                    <path d="M4.978.855a.5.5 0 1 0-.956.29l.41 1.352A4.985 4.985 0 0 0 3 6h10a4.985 4.985 0 0 0-1.432-3.503l.41-1.352a.5.5 0 1 0-.956-.29l-.291.956A4.978 4.978 0 0 0 8 1a4.979 4.979 0 0 0-2.731.811l-.29-.956z"/>
                    <path d="M13 6v1H8.5v8.975A5 5 0 0 0 13 11h.5a.5.5 0 0 1 .5.5v.5a.5.5 0 1 0 1 0v-.5a1.5 1.5 0 0 0-1.5-1.5H13V9h1.5a.5.5 0 0 0 0-1H13V7h.5A1.5 1.5 0 0 0 15 5.5V5a.5.5 0 0 0-1 0v.5a.5.5 0 0 1-.5.5H13zm-5.5 9.975V7H3V6h-.5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 0-1 0v.5A1.5 1.5 0 0 0 2.5 7H3v1H1.5a.5.5 0 0 0 0 1H3v1h-.5A1.5 1.5 0 0 0 1 11.5v.5a.5.5 0 1 0 1 0v-.5a.5.5 0 0 1 .5-.5H3a5 5 0 0 0 4.5 4.975z"/>
                  </svg>
                <div>
                   Required input
                </div>
            </div>
           <!--HERE IS THE ALERT BOX SAYING THAT ALREADYB EXISTS THE DATA-->     
           <div class="alert alert-danger  mt-2" role="alert" id="error">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bug-fill" viewBox="0 0 16 16">
                    <path d="M4.978.855a.5.5 0 1 0-.956.29l.41 1.352A4.985 4.985 0 0 0 3 6h10a4.985 4.985 0 0 0-1.432-3.503l.41-1.352a.5.5 0 1 0-.956-.29l-.291.956A4.978 4.978 0 0 0 8 1a4.979 4.979 0 0 0-2.731.811l-.29-.956z"/>
                    <path d="M13 6v1H8.5v8.975A5 5 0 0 0 13 11h.5a.5.5 0 0 1 .5.5v.5a.5.5 0 1 0 1 0v-.5a1.5 1.5 0 0 0-1.5-1.5H13V9h1.5a.5.5 0 0 0 0-1H13V7h.5A1.5 1.5 0 0 0 15 5.5V5a.5.5 0 0 0-1 0v.5a.5.5 0 0 1-.5.5H13zm-5.5 9.975V7H3V6h-.5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 0-1 0v.5A1.5 1.5 0 0 0 2.5 7H3v1H1.5a.5.5 0 0 0 0 1H3v1h-.5A1.5 1.5 0 0 0 1 11.5v.5a.5.5 0 1 0 1 0v-.5a.5.5 0 0 1 .5-.5H3a5 5 0 0 0 4.5 4.975z"/>
                  </svg>
                <div>
                   Already Exists please try another.....
                </div>
            </div>
            <!--HERE IS THGE CONTENT SAYING THAT SUCCESSFULLY ADD -->
            <div class="alert alert-success mt-2" role="alert" id="successed">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                  </svg>
                <div id="success">
                   ADD SUCCESSFULLY!
                </div>
              </div>
        </div>
        <!--HERE ITSELF ALL THE CONTACT LIST ARE RENDERED IN IT AND HERE THE SERACH FUNCTIONALITY FOR CONTACT -->
        <div class="container d-flex border b-2 p-2 flex-column justify-content-center align-items-center gap-2 mt-3 h3">
            <div class="h3">All Contact List</div>
            <input type="search" class="form-control search-con" placeholder="Search Contact"  id='search1'>
            <button type="button" class="btn btn-secondary search-con"  onclick="search_info()">SEARCH</button>
        </div>
        <div class="container d-flex flex-column align-items-center justify-content-center mt-2" id="info1">
               
        </div>
        <!--HERE IS THE ALERT BOX SAYING THAT UPDATED AND DELETE THING BY CHANGING THE INNERTEXT IN DYNAMIC WAY-->
        <div class="alert alert-success mt-2" role="alert" id="deleted">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
              </svg>
            <div id="del">
            
            </div>
          </div>
         <!--HERE THE MODAL DISPLAY SAYING THAT UPDATE THE FORM IF YOU REQUIRED-->
          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog  modal-dialog-centered">
                <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">UPDATED FORM</h5>
                </div>
                <div class="modal-body">
                    <input class="form-control" id='updated_name' type="text" placeholder="Enter the name">
                    <input class="form-control" id='updated_email' type="email" placeholder="Enter the email">
                    <!--HERE IS THE ALERT BOX SAYING THAT REQUIRED INPUT-->
                    <div class="alert alert-danger  mt-2" role="alert" id="want1_input">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bug-fill" viewBox="0 0 16 16">
                            <path d="M4.978.855a.5.5 0 1 0-.956.29l.41 1.352A4.985 4.985 0 0 0 3 6h10a4.985 4.985 0 0 0-1.432-3.503l.41-1.352a.5.5 0 1 0-.956-.29l-.291.956A4.978 4.978 0 0 0 8 1a4.979 4.979 0 0 0-2.731.811l-.29-.956z"/>
                            <path d="M13 6v1H8.5v8.975A5 5 0 0 0 13 11h.5a.5.5 0 0 1 .5.5v.5a.5.5 0 1 0 1 0v-.5a1.5 1.5 0 0 0-1.5-1.5H13V9h1.5a.5.5 0 0 0 0-1H13V7h.5A1.5 1.5 0 0 0 15 5.5V5a.5.5 0 0 0-1 0v.5a.5.5 0 0 1-.5.5H13zm-5.5 9.975V7H3V6h-.5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 0-1 0v.5A1.5 1.5 0 0 0 2.5 7H3v1H1.5a.5.5 0 0 0 0 1H3v1h-.5A1.5 1.5 0 0 0 1 11.5v.5a.5.5 0 1 0 1 0v-.5a.5.5 0 0 1 .5-.5H3a5 5 0 0 0 4.5 4.975z"/>
                          </svg>
                        <div>
                           Required input
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="update_data()">Update</button>
                </div>
                </div>
            </div>
        </div>
    </div>
 <script>
      let tb = document.getElementById('info1')
       
      /**HERE IS THE ADD DATA API POST CONSIST IN IT **/
 const btn_info = ()=>{
        let name = document.getElementById('input_name').value
        let email = document.getElementById('input_email').value
      
        if(name.length <= 0 ||  email.length <= 0){
            document.getElementById('want_input').style.display = "flex" 
              setTimeout(()=>{
                document.getElementById('want_input').style.display = "none"
                window.location.reload() 
                },2000)
        }
        else{
        const getList = async ()=>{
           
                   await fetch('http://localhost:3001/api/crud',{
                    method:'POST',
                    headers:{
                        'Content-Type':"application/json"
                    },
                    body:JSON.stringify({name : name , email : email})
                })
                .then(res=> {return res.json()})
                .then(data=>{
                    if(data.status === 'success'){
                       document.getElementById('successed').style.display = "flex" 
                       setTimeout(()=>{
                        document.getElementById('successed').style.display = "none"
                        window.location.reload() 
                       },2000)
                    
                    }
                    else{
                        document.getElementById('error').style.display = "flex" 
                       setTimeout(()=>{
                        document.getElementById('error').style.display = "none"
                        window.location.reload() 
                       },2000)
                    }
                })
                .catch((err)=>{
                    console.log(err.message)
                })
            }

        getList()
    }
}

    /*HERE IS THE DISPLAY ALL THE BY USING THE GET API*/
       let result = ''
       const show = async ()=>{
          await  fetch('http://localhost:3001/api/posts')
                    .then(res=>res.json())
                    .then(data=>{
                        data.data.map((item)=>{
                            result += `
                            <div class="display-info mt-1"  id=${item.name}>
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                    <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                  </svg>
                  <div class="info">  
                    <div class="h6">${item.name}</div>
                    <div class="h6">${item.email}</div>
                  </div>            
                  <div class="icons">              
                   <button class="btn border b-0  btn-primary"  data-bs-toggle="modal" data-bs-target="#exampleModal"  onClick='edit(${item.name})'><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                      </svg></button>
                   <button class="btn border b-0  btn-danger" onClick='destroy(${item.name})'><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                        <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                    </svg></button>
                  </div>
                </div>`               
                        })

                      tb.innerHTML = result
                    })
                    .catch((err)=>{
                     console.log(err.message)
                    })      
       }
     show()    
    /*HERE IS THE DELETE API CALLS*/
     const destroy = async (e)=>{
          await fetch('http://localhost:3001/api/del/'+ e.id ,{
                    method:'DELETE'
                    })
                    .then(res=>res.json())
                    .then(data=>{
                        if(data.data.acknowledged){
                            document.getElementById('deleted').style.display = "flex"
                            document.getElementById('del').innerText = "DELETED SUCCESSFULLY"

                            setTimeout(()=>{
                                document.getElementById('deleted').style.display = "none"
                                window.location.reload()
                            },2000)
                        }
                    })
                    .catch((err)=>console.log(err.message))
     }


    /*HERE IS THE PUT/PATCH/UPDATE API CALLS*/ 
     const edit = (e)=>{
       window.localStorage.setItem('name',e.id)
     }
     const update_data = async ()=>{
        const data1 = window.localStorage.getItem('name')
        const input1_name1 = document.getElementById('updated_name').value
        const input1_email1 = document.getElementById('updated_email').value

        if(input1_name1 <= 0 || input1_email1 <= 0){
            document.getElementById('want1_input').style.display = "flex"
              setTimeout(()=>{
                document.getElementById('want1_input').style.display = "none"
                window.location.reload()
             },2000)
        }
      else{
        await  fetch('http://localhost:3001/api/updated/' + data1 ,{
                    method:'PATCH',
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body : JSON.stringify({name:input1_name1,email:input1_email1})
                })
                .then(res=>res.json())
                .then(data=>{
                    if(data.data.acknowledged){
                            document.getElementById('deleted').style.display = "flex"
                            document.getElementById('del').innerText = "UPDATED SUCCESSFULLY"

                            setTimeout(()=>{
                                document.getElementById('deleted').style.display = "none"
                                window.location.reload()
                            },2000)
                        }
                })
                .catch((err)=>{

                        document.getElementById('deleted').style.display = "flex"
                            document.getElementById('del').innerText = "Already existed"

                            setTimeout(()=>{
                                document.getElementById('deleted').style.display = "none"
                                window.location.reload()
                            },2000)
                })
       window.localStorage.clear()    
        }
    }

      /*HERE THE SERACH FOR ONE CONTACT IN THE DATA GET API*/
      const search_info = async ()=>{
            const loc = document.getElementById('search1').value
            await fetch('http://localhost:3001/api/one/' + loc)
            .then(res => res.json())
            .then(data=>{
                if(data.message == "FOUND"){
                    document.getElementById('deleted').style.display = "flex"
                            document.getElementById('del').innerText = "DATA FOUND IN THESE LIST"

                            setTimeout(()=>{
                                document.getElementById('deleted').style.display = "none"
                                window.location.reload()
                            },2000)
                }
                if(data.message == "NOT FOUND") {
                    document.getElementById('deleted').style.display = "flex"
                            document.getElementById('del').innerText = "DATA IS NOT FOUND IN THESE LIST"

                            setTimeout(()=>{
                                document.getElementById('deleted').style.display = "none"
                                window.location.reload()
                            },2000)
                }
            })
            .catch((err)=>console.log(err.message))
        }

</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>